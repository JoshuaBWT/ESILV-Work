var fs = require('fs');
var request = require('request');
var cheerio = require('cheerio');

module.exports = {
    scrapData: function(url, callback)
    {
      request(url, function(error, response, html){

       // First we'll check to make sure no errors occurred when making the request
       if(!error)
       {
         try
         {
           // Next, we'll utilize the cheerio library on the returned html which will essentially give us jQuery functionality
          var $ = cheerio.load(html);

          //Ici on récupère le script contenant les données au format txt.
          var stringedData = $("body").children()[0].children[0].data;

          //On eleve l'initialisation de la variable
          stringedData = stringedData.substr(17, stringedData.length);
          //On transforme le texte en JSON

          var trueJson = JSON.stringify(eval("(" + stringedData + ")"));

          console.log(JSON.parse(trueJson));
          callback(JSON.parse(trueJson));
         }
         catch(err)
         {
           console.log(err);
         }

       }
       else {
          console.log(error)
       }
     });
    }
}
